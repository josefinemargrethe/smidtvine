<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Smidt Vine:</title>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet" />
    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png" />
    <style>
      .fragt_info {
        border: 3px solid var(--specialitetColor);
        margin: 2vw;
      }

      .important_text {
        background-image: linear-gradient(90deg, transparent 50%, var(--wine-color) 0);
      }

      .wine_name {
        color: var(--specialitetColor);
      }

      .content {
        grid-template-columns: 20% 80%;
      }

      #wines {
        margin: 20vh 3vw 3vw 0;
      }

      #wines img {
        max-width: 100px;
      }

      .single_product {
        margin: 3vw;
      }

      .single_product .right {
        margin-top: 0;
      }

      #interesse h3 {
        margin-left: 3vw;
      }
    </style>
  </head>
  <body>
    <header class="mobil">
      <nav class="mobil">
        <div id="myNav" class="overlay mobile_nav">
          <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
          <div class="overlay-content">
            <a href="index.html"><img src="img/logo5.png" alt="Smidt Vine logo" class="burger_logo" /></a>
            <a href="index.html">Hjem</a>
            <a href="allevine.html">Vine</a>
            <a href="allespecialiteter.html">Specialiteter</a>
            <a href="moed_smidtvine.html">Mød Smidt Vine</a>
            <a href="om.html">Om Smidt Vine</a>
            <p>Mød Vinbønderne</p>
            <a href="nico_mosel.html" class="mobilnav_vinbonde">- Nico i Mosel</a>
            <a href="josep_montsant.html" class="mobilnav_vinbonde">- Josep i Mont Sant</a>
            <a href="kontakt.html">Kontakt</a>
          </div>
        </div>
        <span class="openbtn" onclick="openNav()">&#9776;</span>
      </nav>
    </header>
    <header class="desktop">
      <nav class="desktop desktop_nav nav_bg" id="desktop_nav">
        <a href="index.html">Hjem</a>
        <a href="allevine.html">Vine</a>
        <a href="allespecialiteter.html"><b>Specialiteter</b></a>
        <a href="moed_smidtvine.html">Mød Smidt Vine</a>
        <a href="om.html">Om Smidt Vine</a>
        <div class="dropdown">
          <button onclick="myFunction()" class="dropbtn">Mød vinbønderne</button>
          <div id="myDropdown" class="dropdown-content">
            <a href="nico_mosel.html" class="mobilnav_vinbonde">- Nico i Mosel</a>
            <a href="josep_montsant.html" class="mobilnav_vinbonde">- Josep i Mont Sant</a>
          </div>
        </div>
        <a href="kontakt.html">Kontakt</a>
      </nav>
    </header>

    <main>
      <!-- <section id="vine_headline">
        <h1><span class="vine_headline">Olivenolie</span></h1>
      </section> -->

      <section id="wines">
        <article class="content">
          <aside id="contextnav">
            <nav>
              <a href="allespecialiteter.html">Alle specialiteter</a>
              <a href="olivenolie.html">Olivenolie</a>
              <a href="oliven.html">Oliven</a>
              <a href="oliventapenade.html">Oliventapenade</a>
            </nav>
          </aside>
          <div id="single_wrapper">
            <div id="singleview"></div>
            <div class="fragt_info">
              <p>
                Husk at vi altid har <span class="important_text">gratis fragt og dag-til-dag levering i 5700 Svendborg.</span> Ved køb for mere end 500 kr. er der også gratis fragt på resten af Fyn.
                Du kan også <span class="important_text">altid hente dine varer på vores adresse i Svendborg.</span> Læs mere om hvordan du køber hos os her.
              </p>
            </div>
            <div id="interesse"></div>
            <div id="mix_match"></div>
          </div>
        </article>
      </section>
    </main>

    <footer id="mobile_footer">
      <a href="index.html"><img src="img/logo5.png" alt="Smidt Vine logo" class="footer_logo" /></a>
      <article class="footer_wrapper">
        <article>
          <p>Smidt Vine</p>
          <p>v/Bruno Kristensen</p>
          <p>Strandvej 75</p>
          <p>5700 Svendborg</p>
          <p class="cvr">CVR: 37223115</p>
        </article>
        <article>
          <p>Kontakt:</p>
          <p>Telefon: 21 95 08 75</p>
          <p>
            Mail: <span><a href="mailto:info@smidtvine.dk" target="_blank">info@smidtvine.dk</a></span>
          </p>
          <a href="https://facebook.com/smidtvine" target="_blank">Følg Smidt Vine på Facebook!</a>
        </article>
      </article>
    </footer>
    <footer id="desk_footer">
      <a href="index.html"><img src="img/logo5.png" alt="Smidt Vine logo" class="footer_logo" /></a>
      <p>
        Smidt Vine v/Bruno Kristensen. Strandvej 75. 5700 Svendborg. Cvr: 37223115. Kontakt: Telefon: 21 95 08 75. Mail:
        <span><a href="mailto:info@smidtvine.dk" target="_blank">info@smidtvine.dk</a></span>
      </p>
    </footer>

    <script>
      let urlParams = new URLSearchParams(window.location.search); //API der henter data fra afsendersiden, henter her url query string ?id=123 eller det id der er blevet sendt med fra afsendersiden
      let id = urlParams.get("id"); //returnerer "id"
      let info = [];
      let specialitet;
      let itemType;

      document.addEventListener("DOMContentLoaded", start);

      function start() {
        async function getJson() {
          let url = "https://josefinemargrethe.dk/kea/4-semester/smidtvine/wordpress/wp-json/wp/v2/specialiteter?per_page=100";
          let jsonData = await fetch(url);

          info = await jsonData.json();
          //console.log(info);

          //Efter json-filen er hentet fra Wordpress, laves et loop, der gennemgår hvert objekt i array'et og leder efter det id, der passer til det, der blev sendt med fra afsendersiden, samt hvilken farve, det har. Når det er fundet, defineres objektet som item, og farven som itemColor. Da farven skal udfyldes på WP som en form/drop-down, er det reelt et array, som har første position 0. Der tilføjes også en tæller, i, der tæller hvor mange objekter der er:

          info.forEach((obj, i) => {
            if (obj.id == id) {
              specialitet = obj;
              itemType = obj.hvilken_specialitet[0];
            }

            //her laves en betingelse som siger, at FØRST når ALLE objekterne i array'et er læst, må der gåes videre til de efterfølgende funktioner. Her bruges tælleren i til at sammenligne med array'ets længde. Da 0. position tælles med er det i +1.

            //console.log(info.length, i)
            if (info.length == i + 1) {
              openProduct();
              getType(info);
            }
          });
        }

        function getType(info) {
          console.log("gettype");
          console.log(info);

          // her laves et loop, hvor man gennemgår array'et produkt for produkt, dvs. alle subposts i shop pod'en og tjekker, hvilke der har den farve, som passer til vores id længere oppe.

          info.forEach((mix) => {
            console.log(mix.id + " id = " + id);

            if (mix.hvilken_specialitet == itemType && mix.id != id && mix.udsolgt == "nej") {
              document.querySelector("#mix_match").innerHTML += `


        <div class="single_wine">
          <a href="specialitet.html?id=${mix.id}"><div class="wine_image"><img src="${mix.specialitet_billede.guid}" alt="${mix.specialitet_billede.post_title}"> </div>
                    <div class="wine_info">
                      <h2 class="wine_name">${mix.specialitet_navn}</h2>
                      <p class="wine_description">${mix.kort_beskrivelse}</p>
                      <p class="wine_price_six"><b>Pris: ${mix.specialitet_pris} kr.</b></p>
                      </a>
      </div>

      `;
            }
          });
        }

        //Her indsættes en HTML-artikel med produktdetaljer og billeder for det produkt, som vores id tilhører i array'et.

        function openProduct() {
          if (specialitet.udsolgt == "ja") {
            document.querySelector("#singleview").innerHTML = `
                              <article class = "single_product">
      <div class="single_wine">
                    <div class="wine_image"><img src="${specialitet.specialitet_billede.guid}" alt="${specialitet.specialitet_billede.post_title}"> </div>
                    <div class="wine_info">
                      <h2 class="wine_name">${specialitet.specialitet_navn}</h2>
                      <p class="wine_description">${specialitet.kort_beskrivelse}</p>
                      <p class="wine_price_six" style="color:rgb(192, 98, 98);">${specialitet.specialitet_navn} er desværre midlertidigt udsolgt!</p>

      </div>
      </div>
      <div class="middle"><h3>Mere info</h3>${specialitet.specialitet_beskrivelse}</div>
      <div class="right"><h3>Serveringsforslag</h3>${specialitet.specialitet_serveringsforslag}</div>
                              </article>
                              `;
            document.querySelector("#interesse").innerHTML = `<h3>Glad for ${specialitet.hvilken_specialitet}? Så er du måske interesseret i:</h3>`;
          } else if (specialitet.udsolgt == "nej" && specialitet.flerstykspris == "") {
            document.querySelector("#singleview").innerHTML = `
                              <article class = "single_product">
      <div class="single_wine">
                    <div class="wine_image"><img src="${specialitet.specialitet_billede.guid}" alt="${specialitet.specialitet_billede.post_title}"> </div>
                    <div class="wine_info">
                      <h2 class="wine_name">${specialitet.specialitet_navn}</h2>
                      <p class="wine_description">${specialitet.kort_beskrivelse}</p>
                      <p class="wine_price_six"><b>Pris: ${specialitet.specialitet_pris} kr.</b></p>
                      
      </div>
      </div>
      <div class="middle"><h3>Mere info</h3>${specialitet.specialitet_beskrivelse}</div>
      <div class="right"><h3>Serveringsforslag</h3>${specialitet.specialitet_serveringsforslag}</div>
                              </article>
                              `;
            document.querySelector("#interesse").innerHTML = `<h3>Glad for ${specialitet.hvilken_specialitet}? Så er du måske interesseret i:</h3>`;
          } else {
            document.querySelector("#singleview").innerHTML = `
                              <article class = "single_product">
      <div class="single_wine">
                    <div class="wine_image"><img src="${specialitet.specialitet_billede.guid}" alt="${specialitet.specialitet_billede.post_title}"> </div>
                    <div class="wine_info">
                      <h2 class="wine_name">${specialitet.specialitet_navn}</h2>
                      <p class="wine_description">${specialitet.kort_beskrivelse}</p>
                      <p class="wine_price_six"><b>Pris: ${specialitet.specialitet_pris} kr.</b></p>
                      <p class="wine_price">Tag 4 glas for ${specialitet.flerstykspris} kr.</p>
      </div>
      </div>
      <div class="middle"><h3>Mere info</h3>${specialitet.specialitet_beskrivelse}</div>
      <div class="right"><h3>Serveringsforslag</h3>${specialitet.specialitet_serveringsforslag}</div>
                              </article>
                              `;
            document.querySelector("#interesse").innerHTML = `<h3>Glad for ${specialitet.hvilken_specialitet}? Så er du måske interesseret i:</h3>`;
          }

          document.querySelector("title").textContent += ` ${specialitet.specialitet_navn}`;
        }

        getJson();
      }
    </script>
    <script src="header.js"></script>
    <!-- <script src="fragt.js"></script> -->
  </body>
</html>
